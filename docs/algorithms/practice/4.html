<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4</title>
    <style>
        :root {
            --text-color: #2c3e50;
            --background-color: #ffffff;
            --accent-color: #3498db;
            --border-color: #ecf0f1;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --text-color: #ecf0f1;
                --background-color: #2c3e50;
                --accent-color: #3498db;
                --border-color: #34495e;
            }
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.6;
            max-width: 50rem;
            margin: 0 auto;
            padding: 2rem;
            color: var(--text-color);
            background: var(--background-color);
        }

        nav {
            position: sticky;
            top: 0;
            background: var(--background-color);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 0;
            margin-bottom: 2rem;
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }

        nav a {
            color: var(--accent-color);
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        nav a:hover {
            background-color: var(--border-color);
        }

        .content {
            margin-top: 2rem;
        }

        h1, h2, h3, h4, h5, h6 {
            margin-top: 2rem;
            margin-bottom: 1rem;
        }

        code {
            background: var(--border-color);
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-size: 0.9em;
        }

        pre code {
            display: block;
            padding: 1rem;
            overflow-x: auto;
        }

        img {
            max-width: 100%;
            height: auto;
        }

        .meta {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 2rem;
        }
    </style>
</head>
<body>
    <nav>
        <a href="/index.html">Home</a>
<a href="/operating-systems/v1-kernels-and-processes/1-introductions.html">1 Introductions</a>
<a href="/networks/0-foundation/1-network-components-and-protocols.html">1 Network Components And Protocols</a>
<a href="/operating-systems/v4-persistent-storage/11-file-systems-overview.html">11 File Systems Overview</a>
<a href="/operating-systems/v4-persistent-storage/13-files-and-directories.html">13 Files And Directories</a>
<a href="/networks/0-foundation/2-physical-layer.html">2 Physical Layer</a>
<a href="/operating-systems/v1-kernels-and-processes/2-the-kernel-abstraction.html">2 The Kernel Abstraction</a>
<a href="/networks/0-foundation/3-performance.html">3 Performance</a>
<a href="/operating-systems/v1-kernels-and-processes/3-the-programming-interface.html">3 The Programming Interface</a>
<a href="/algorithms/practice/4.html">4</a>
<a href="/operating-systems/v2-concurrency/4-concurrency-and-threads.html">4 Concurrency And Threads</a>
<a href="/operating-systems/v2-concurrency/5-synchronizing-access-to-shared-objects.html">5 Synchronizing Access To Shared Objects</a>
<a href="/operating-systems/v2-concurrency/7-multiprocessor-scheduling.html">7 Multiprocessor Scheduling</a>
<a href="/operating-systems/v2-concurrency/7-queueing-theory.html">7 Queueing Theory</a>
<a href="/operating-systems/v2-concurrency/7-uniprocessor-scheduling.html">7 Uniprocessor Scheduling</a>
<a href="/networks/4-transport/ACK-clocking.html">Ack Clocking</a>
<a href="/algorithms/approximation-algorithms.html">Approximation Algorithms</a>
<a href="/networks/3-network/ARP.html">Arp</a>
<a href="/algorithms/BFS.html">Bfs</a>
<a href="/algorithms/patterns/BFS.html">Bfs</a>
<a href="/networks/3-network/BGP.html">Bgp</a>
<a href="/distributed-systems/bigtable.html">Bigtable</a>
<a href="/algorithms/bipartite-graphs.html">Bipartite Graphs</a>
<a href="/networks/5-application/CDNs.html">Cdns</a>
<a href="/designing-data-intensive-applications/part-1-foundations-of-data-systems/ch1-reliable-scalable-and-maintainable-applications.html">Ch1 Reliable Scalable And Maintainable Applications</a>
<a href="/designing-data-intensive-applications/part-3-derived-data/ch10-batch-processing.html">Ch10 Batch Processing</a>
<a href="/designing-data-intensive-applications/part-1-foundations-of-data-systems/ch2-data-models-and-query-languages.html">Ch2 Data Models And Query Languages</a>
<a href="/designing-data-intensive-applications/part-1-foundations-of-data-systems/ch3-storage-and-retrieval.html">Ch3 Storage And Retrieval</a>
<a href="/designing-data-intensive-applications/part-1-foundations-of-data-systems/ch4-encoding-and-evolution.html">Ch4 Encoding And Evolution</a>
<a href="/designing-data-intensive-applications/part-2-distributed-data/ch5-replication.html">Ch5 Replication</a>
<a href="/linear-algebra/cheatsheet.html">Cheatsheet</a>
<a href="/distributed-systems/clocks.html">Clocks</a>
<a href="/ds-backup/clocks.html">Clocks</a>
<a href="/networks/1-physical/coding-and-modulation.html">Coding And Modulation</a>
<a href="/teaching/modern-java/collections-and-records.html">Collections And Records</a>
<a href="/digital-design/combinational-logic.html">Combinational Logic</a>
<a href="/operating-systems/lecture-notes/components.html">Components</a>
<a href="/cheatsheets/circuits/components.html">Components</a>
<a href="/algorithms/connected-components.html">Connected Components</a>
<a href="/distributed-systems/consistency.html">Consistency</a>
<a href="/distributed-systems/consistent-global-state.html">Consistent Global State</a>
<a href="/ds-backup/consistent-global-state.html">Consistent Global State</a>
<a href="/algorithms/DAGs.html">Dags</a>
<a href="/algorithms/DFS.html">Dfs</a>
<a href="/networks/3-network/DHCP.html">Dhcp</a>
<a href="/distributed-systems/disconnected-operation.html">Disconnected Operation</a>
<a href="/distributed-systems/distributed-cache-coherence.html">Distributed Cache Coherence</a>
<a href="/algorithms/divide-and-conquer.html">Divide And Conquer</a>
<a href="/cheatsheets/algorithms/divide-and-conquer.html">Divide And Conquer</a>
<a href="/networks/5-application/DNS.html">Dns</a>
<a href="/algorithms/dynamic-programming.html">Dynamic Programming</a>
<a href="/distributed-systems/dynamo-db.html">Dynamo Db</a>
<a href="/performance-engineering/efficiently-implementing-state-pattern-JVM.html">Efficiently Implementing State Pattern Jvm</a>
<a href="/cheatsheets/circuits/electricity.html">Electricity</a>
<a href="/linear-algebra/elementry-linear-algebra.html">Elementry Linear Algebra</a>
<a href="/networks/2-direct-links/errors.html">Errors</a>
<a href="/operating-systems/lecture-notes/file-systems.html">File Systems</a>
<a href="/networks/4-transport/flow-control.html">Flow Control</a>
<a href="/networks/2-direct-links/framing.html">Framing</a>
<a href="/networks/3-network/global-internet.html">Global Internet</a>
<a href="/distributed-systems/google-file-system.html">Google File System</a>
<a href="/cheatsheets/algorithms/graphs.html">Graphs</a>
<a href="/algorithms/problems/graphs-and-trees.html">Graphs And Trees</a>
<a href="/algorithms/graphs-intro.html">Graphs Intro</a>
<a href="/algorithms/greedy-algorithms.html">Greedy Algorithms</a>
<a href="/operating-systems/lecture-notes/handle-tables.html">Handle Tables</a>
<a href="/networks/5-application/HTTP.html">Http</a>
<a href="/networks/3-network/ICMP.html">Icmp</a>
<a href="/algorithms/induction.html">Induction</a>
<a href="/networks/0-foundation/information-theory.html">Information Theory</a>
<a href="/networks/3-network/internetworking.html">Internetworking</a>
<a href="/cheatsheets/algorithms/intervals.html">Intervals</a>
<a href="/machine-learning-for-big-data/intro-mapreduce-spark.html">Intro Mapreduce Spark</a>
<a href="/operating-systems/lecture-notes/io-systems-secondary-storage.html">Io Systems Secondary Storage</a>
<a href="/digital-design/karnaugh-maps.html">Karnaugh Maps</a>
<a href="/operating-systems/lecture-notes/kernel-abstraction.html">Kernel Abstraction</a>
<a href="/operating-systems/section-notes/lab-3-questions.html">Lab 3 Questions</a>
<a href="/teaching/modern-java/lambdas-and-streams.html">Lambdas And Streams</a>
<a href="/signal-conditioning/lecture-notes/lecture-1.html">Lecture 1</a>
<a href="/signal-conditioning/lecture-notes/lecture-2.html">Lecture 2</a>
<a href="/signal-conditioning/lecture-notes/lecture-3.html">Lecture 3</a>
<a href="/signal-conditioning/lecture-notes/lecture-4.html">Lecture 4</a>
<a href="/signal-conditioning/lecture-notes/lecture-5.html">Lecture 5</a>
<a href="/signal-conditioning/lecture-notes/lecture-6.html">Lecture 6</a>
<a href="/venv/lib/python3.13/site-packages/Markdown-3.7.dist-info/LICENSE.html">License</a>
<a href="/algorithms/linear-programming.html">Linear Programming</a>
<a href="/distributed-systems/load-balancing.html">Load Balancing</a>
<a href="/distributed-systems/managing-critical-state.html">Managing Critical State</a>
<a href="/ds-backup/managing-critical-state.html">Managing Critical State</a>
<a href="/networks/1-physical/media.html">Media</a>
<a href="/networks/3-network/motivation.html">Motivation</a>
<a href="/networks/2-direct-links/multiple-access.html">Multiple Access</a>
<a href="/distributed-systems/mutual-exclusion.html">Mutual Exclusion</a>
<a href="/ds-backup/mutual-exclusion.html">Mutual Exclusion</a>
<a href="/algorithms/network-flows.html">Network Flows</a>
<a href="/networks/3-network/networking-services.html">Networking Services</a>
<a href="/distributed-systems/non-blocking-two-phase-commit.html">Non Blocking Two Phase Commit</a>
<a href="/distributed-systems/ordering-events-in-distributed-systems.html">Ordering Events In Distributed Systems</a>
<a href="/ds-backup/ordering-events-in-distributed-systems.html">Ordering Events In Distributed Systems</a>
<a href="/networks/5-application/overview.html">Overview</a>
<a href="/operating-systems/lecture-notes/page-faults.html">Page Faults</a>
<a href="/operating-systems/lecture-notes/paging.html">Paging</a>
<a href="/tmp/pairing-algorithm.html">Pairing Algorithm</a>
<a href="/distributed-systems/paxos-architecture.html">Paxos Architecture</a>
<a href="/distributed-systems/paxos-intro.html">Paxos Intro</a>
<a href="/ds-backup/paxos-intro.html">Paxos Intro</a>
<a href="/distributed-systems/paxos-made-simple.html">Paxos Made Simple</a>
<a href="/ds-backup/paxos-made-simple.html">Paxos Made Simple</a>
<a href="/designing-data-intensive-applications/part-2-distributed-data/preface.html">Preface</a>
<a href="/distributed-systems/primary-backup.html">Primary Backup</a>
<a href="/ds-backup/primary-backup.html">Primary Backup</a>
<a href="/operating-systems/lecture-notes/processes.html">Processes</a>
<a href="/linear-algebra/python-cheatsheet.html">Python Cheatsheet</a>
<a href="/digital-design/quartus-workflow.html">Quartus Workflow</a>
<a href="/README.html">Readme</a>
<a href="/networks/reference.html">Reference</a>
<a href="/operating-systems/reference.html">Reference</a>
<a href="/cheatsheets/java-spring-boot/reference.html">Reference</a>
<a href="/networks/2-direct-links/retransmission.html">Retransmission</a>
<a href="/networks/3-network/routing.html">Routing</a>
<a href="/distributed-systems/RPC.html">Rpc</a>
<a href="/ds-backup/RPC.html">Rpc</a>
<a href="/cheatsheets/java-spring-boot/running.html">Running</a>
<a href="/algorithms/runtime.html">Runtime</a>
<a href="/distributed-systems/scaling-web-services.html">Scaling Web Services</a>
<a href="/ds-backup/scaling-web-services.html">Scaling Web Services</a>
<a href="/operating-systems/section-notes/section-1.html">Section 1</a>
<a href="/digital-design/sequential-logic.html">Sequential Logic</a>
<a href="/distributed-systems/sharding.html">Sharding</a>
<a href="/scripts/simple.html">Simple</a>
<a href="/algorithms/patterns/sliding-window.html">Sliding Window</a>
<a href="/networks/sockets.html">Sockets</a>
<a href="/tmp/bench/spec.html">Spec</a>
<a href="/algorithms/stable-matching.html">Stable Matching</a>
<a href="/networks/2-direct-links/switching.html">Switching</a>
<a href="/digital-design/system-verilog.html">System Verilog</a>
<a href="/networks/4-transport/TCP.html">Tcp</a>
<a href="/operating-systems/lecture-notes/tlb.html">Tlb</a>
<a href="/algorithms/tmp.html">Tmp</a>
<a href="/networks/4-transport/transport-overview.html">Transport Overview</a>
<a href="/algorithms/tree-intro.html">Tree Intro</a>
<a href="/distributed-systems/two-phase-commit.html">Two Phase Commit</a>
<a href="/networks/4-transport/UDP.html">Udp</a>
<a href="/digital-design/waveform-diagram.html">Waveform Diagram</a>
<a href="/operating-systems/lecture-notes/windows-memory-management.html">Windows Memory Management</a>
<a href="/operating-systems/lecture-notes/windows-objects-handles-refcounts.html">Windows Objects Handles Refcounts</a>
<a href="/operating-systems/lecture-notes/windows-rtz.html">Windows Rtz</a>
<a href="/networks/2-direct-links/wireless.html">Wireless</a>
    </nav>
    <main>
        <h1>4</h1>
        <div class="meta">
            Last modified: 2024-04-24
        </div>
        <div class="content">
            <h1 id="problem-set-4">Problem Set 4</h1>
<h2 id="problem-1">Problem 1</h2>
<p>$I = [(0, 1), (0, 3), (4, 5), (2, 5)]$</p>
<p>These intervals are already sorted by finish time.</p>
<ol>
<li>Initially, there are no classrooms allocated, so $I_0$ is placed in $C_0$.</li>
<li>Next, $I_1$ is incompatible with $I_0$, so it is placed in a newly allocated $C_1$.</li>
<li>$I_2$ is compatible with $C_0$ and $C_1$, so it is placed in $C_0$.</li>
<li>$I_3$ isn't compatible with $C_0$ or $C_1$ (because of $I_2$ and $I_1$ respectively), so it is placed in a newly allocated $C_2$</li>
</ol>
<p>So we have...</p>
<ul>
<li>$C_0 = { I_0, I_2 }$</li>
<li>$C_1 = { I_1 }$</li>
<li>$C_2 = { I_3 }$</li>
</ul>
<p>As you can see below, the maximum depth is 2, so this algorithm allocated more than max-depth classrooms.</p>
<pre><code class="language-plaintext">
I_1  +-----------------+     +-----+  I_2
I_0  +-----+     +-----------------+  I_3

     +-----+-----+-----+-----+-----+
     0     1     2     3     4     5
</code></pre>
<h2 id="problem-2">Problem 2</h2>
<h3 id="algorithm">Algorithm</h3>
<ul>
<li>Let $S$ be the (initially empty) set of pairs</li>
<li>Sort $A = a_1, a_2, \ldots, a_n$ in increasing order to get $B = b_1, b_2, \ldots, b_n$.</li>
<li>While there are elements remaining, pick the smallest and largest element (the first and last $b_i, b_j$), and remove them from $B$.</li>
<li>Add ${b_i, b_j}$ to $S$</li>
<li>Once $B$ is empty, return $S$.</li>
</ul>
<pre><code class="language-python"># O(nlog(n))
def min_max_pairs(A):
  A.sort()

  l, r = 0, len(A) - 1
  res = -infinity
  while l &lt; r:
    res = max(res, A[l] + A[r])
    l += 1
    r -= 1
  return res
</code></pre>
<h3 id="running-time">Running Time</h3>
<p>Sorting takes $O(n\log(n))$. Then, we perform $\frac{n}{2}$ iterations of our while loop, each requiring constant work. This gives us an overall runtime of $O(n\log(n))$</p>
<h3 id="correctness-greedy-stays-ahead">Correctness: Greedy Stays Ahead</h3>
<p>For notational convenience, let $a_1, a_2, \ldots, a_n$ be sorted. Let $G$ be my algorithm, and $X$ be the optimum, and for the sake of contradiction, suppose $X$ chooses pairs differently from $G$, e.g. not of the form $(a_i, a_{n - i})$ as $G$ does.</p>
<p>Let $g(a_i)$ be a function that outputs the "choice" of partner for any $a_i$ by $G$, so $g(a_i) = a_{n - i}$, and let $x(a_i)$ mean the same for $X$.</p>
<p>Define $P(n)$ as...</p>
<p>Given $n$ sorted numbers (with $n$ being even) $a_1, \ldots a_n$, $G_{max} \le X_{max}$, where $G_{max}$ and $X_{max}$ are defined as follows:</p>
<p>$$
G_{max} = max({ g(a_i) + a_i : 1 \le i \le n })
$$</p>
<p>$$
X_{max} = max({ x(a_i) + a_i : 1 \le i \le n })
$$</p>
<p><strong>Base Case</strong>:</p>
<p>$P(2)$: we have $a_1, a_2$, with $a_1 &lt; a_2$. There is only one possible pair, so $G_{max} \le X_{max}$, and $P(2)$ holds.</p>
<p><strong>IH</strong>: Suppose $P(k - 2)$ holds.</p>
<p><strong>IS</strong>:</p>
<p>Let $A = a_1, a_2, \ldots, a_{k - 1}, a_k$ be sorted numbers. Remove $a_1$ and $a_k$ to get $A' = a_2, \ldots, a_{k - 1}$. Since $A'$ is still sorted, and has $|A'| = k - 2$, we know $P(k - 2)$ holds.</p>
<p>Therefore, we have $G'<em>{max} \le X'</em>{max}$ for $A'$.</p>
<p>Consider an arbitrary pair chosen by $G$ on $A'$, $(a_i, a_j)$, with $a_i \le a_j$. By our sort order, we have $a_1 \le a_i \le a_j \le a_k$. Now, consider the ways we could swap elements between these two pairs</p>
<p><strong>Case 1</strong>: $a_1 + a_k &gt; a_i + a_j$</p>
<ul>
<li>$(a_1, a_j), (a_i, a_k)$</li>
<li>$a_i + a_k \ge a_1 + a_k$, since $a_i \ge a_1$</li>
<li>$(a_1, a_i), (a_k, a_j)$</li>
<li>$a_k + a_j \ge a_1 + a_k$, since $a_j \ge a_i$</li>
</ul>
<p><strong>Case 2</strong>: $a_1 + a_k \le a_i + a_j$</p>
<ul>
<li>$(a_1, a_j), (a_i, a_k)$</li>
<li>$a_i + a_k \ge a_i + a_j$, since $a_k \ge a_j$</li>
<li>$(a_1, a_i), (a_k, a_j)$</li>
<li>$a_k + a_j \ge a_i + a_j$, since $a_k \ge a_i$</li>
</ul>
<p>In either of the above cases, we are increasing the max of the two sums by swapping elements, and this holds for an arbitrary $a_i, a_j$ chosen by $G'$, which is at least as good as the optimum. Since we know $X'<em>{max} \ge G'</em>{max}$, and also that any pairing other than the one picked by $G$ ($a_1, a_k$) leads to an increased sum, it must be the case that $G_{max} \le X_{max}$, and so $P(k)$ holds.</p>
<h2 id="problem-3">Problem 3</h2>
<p><strong>Lemma (1)</strong>: For any two trees $T_1$ and $T_2$ with $v \in T_1$ and $u \in T_2$, if we add the edge $(u, v)$ between the two trees, we get a new tree $T_3$.</p>
<p><strong>Proof</strong>:</p>
<p>Let $n$ be the number of vertices in $T_1$, and $m$ be the number of vertices in $T_2$. Since they are both trees, we have $n - 1$ edges in $T_1$, and $m - 1$ edges in $T_2$. Connecting $T_1$ and $T_2$ on $(u, v)$ then results in a graph with $m + n$ vertices, and $m - 1 + n - 1 = m + n - 1$ edges.</p>
<p>Furthermore, both $T_1$ and $T_2$ are connected. Therefore, after adding an the edge $(u, v)$ between them, this results in a graph that is also connected, since all vertices in $T_1$ can reach all vertices in $T_2$ through this edge, and vice versa.</p>
<p>Finally, since the resulting graph is connected and has $m + n - 1$ edges, it must be a tree.</p>
<p><strong>Lemma (2)</strong>: For any tree $T$ removing an edge $e = (u, v)$ results in two trees.</p>
<p><strong>Proof</strong>:</p>
<p>Let $T$ be an arbitrary tree and $e = (u, v)$ be an arbitrary edge in $T$.</p>
<p>Removing the edge $e$ from $T$ results in two separate connected components, each containing a subset of the vertices from $T$.</p>
<p>The resulting components have no cycles, since $T$ was a tree, and is therefore acyclic, and removing an edge cannot create a cycle.</p>
<p>Each component is connected, as every pair of vertices in $T$ was connected by a unique path (since $T$ is a tree), and removing $e$ does not disconnect any other pairs of vertices within each component.</p>
<p>Therefore, the two components formed by cutting $T$ on $e$ are both trees.</p>
<p><strong>Lemma (3)</strong>: For any partition of vertices of a tree $T$ into two sets $A$ and $B$, there must be an edge ($u, v$) between some vertex $u \in A$ and $v \in B$.</p>
<p><strong>Proof</strong>:</p>
<p>Let $T$ be a tree and ${ A, B } be a partition of vertices in $T$. Suppose for the sake of contradiction that there was no edge between vertices in $A$ and $B$.</p>
<p>Let $x \in A$ and $y \in B$ be arbitrary vertices. Since $T$ is a tree, it is connected. Therefore, there must exist a path $x \to y$, so at some point along this path a vertex in $A$ must be connected to a vertex in $B$, which is a contradiction.</p>
<p><strong>Main Proof</strong>:</p>
<p>Let $T_1$ and $T_2$ be edge disjoint spanning trees over $G$. Consider an arbitrary edge $e = (u, v) \in T_1$.</p>
<p>Let $T_1' = T_1 - e$. Since $T_1$ was a tree, this splits $T_1'$ into two connected components $C_1, C_2$, both of which are also trees by (2). We have $u \in C_1$ and $v \in C_2$.</p>
<p>Since $T_2$ is also a tree, and is therefore connected, by (3), there must exist an edge $f = (x, y) \in T_2$, such that $x \in C_1$ and $y \in C_2$. For any two vertices in a tree, there is exactly one path between them, since otherwise there would either be a non-connected vertex (no path), or a cycle (more than one path). We know $(u, v) \notin T_2$, since $T_1$ and $T_2$ are edge-disjoint, so letting $u, p_1, p_2, \ldots, v$ be the path between $u$ and $v$ in $T_2$, choose $f = (u, p_1)$ (where $p_1$ may or may not be $v$).</p>
<p>Cutting $T_2$ on $f$ to get $T_2'$, we have two connected components $K_1$, $K_2$, both of which are trees. Now, we can add $e$ to $T_2'$, and by (1), we get a tree, since $K_1$ and $K_2$ are both trees, with $u \in K_1$ and $v \in K_2$.</p>
<p>Similarly, adding $f = (x, y)$ to $T_1'$, we also get a tree by (1), since $C_1$ is a tree with $x \in C_1$, and $C_2$ is a tree with $y \in C_2$.</p>
<p>Therefore, we have both $T_1 - e + f$ and $T_2 - f + e$ are trees.</p>
<h2 id="problem-5">Problem 5</h2>
<p>Call my algorithm $S(A, l, u)$.</p>
<h3 id="correctness">Correctness</h3>
<p><strong>Claim</strong>: Given a list of $n$ numbers $A = a_1, a_n, \ldots a_n$, the number of interval sums in $[l, u]$ is correctly calculated by $S(A, l, u) = R + L + C$, where they are defined as...</p>
<p>$$L = S([a_1, \ldots, a_{\lceil n/2 \rceil - 1}], l, u)$$</p>
<p>i.e. the number of interval sums in the first half of $A$ $[l, u]$.</p>
<p>$$R = S([a_{\lceil n/2 \rceil}, \ldots, a_n], l, u)$$</p>
<p>i.e. the number of interval sums in the latter half of $A$ in $[l, u]$.</p>
<p>$$C = | {  (i, j) : i \le \lceil n/2 \rceil - 1 \land j \ge \lceil n/2 \rceil \land I(i, j) \in [l, u] } |$$</p>
<p>i.e the number of interval sums that cross over the midpoint of $A$ and are in $[l, u]$</p>
<p><strong>Proof</strong>: By induction</p>
<p>Let $P(n)$ be the above claim, i.e. that given $n$ numbers $A$ and a range $[l, u]$, my algorithm returns the number of interval sums on $A$ that are between $[l, u]$ via the following calculation:</p>
<p>$$S(A, l, u) = L + R + C$$</p>
<p><strong>Base Case</strong>:</p>
<p>$P(1)$</p>
<p>Given a single number, there is only one interval sum to consider, i.e. $I(1, 1)$. In this case, the left half of $A$ is empty, and the right half consists of a single element. There are no interval sums that cross over the midpoint, so if $l \le I(1, 1) \le u$, then $L = 1$, and otherwise, $L = 0$. This gives us a final answer of $S(A, l, u) = L + R + C = 0 + R + 0 = R$. There is only one possible interval to consider, and $R$ is set depending on whether it is in $[l, u]$, so this is correct.</p>
<p>$P(2)$</p>
<p>Given two numbers $A = a_1, a_2$, we have $3$ intervals to check corresponding to $I(1, 1)$, $I(2, 2)$, and $I(1, 2)$. We have that $L = 1$ if $I(1, 1) \in [l, u]$, and $0$ otherwise, $R = 1$ if $I(2, 2) \in [l, u]$, and $0$ otherwise, and $C = 1$ if $I(1, 2) \in [l, u]$, and $0$ otherwise. Therefore, we check all possible interval sums, and output the sum of $L, R, C$, which corresponds to the number of these interval sums in $[l, u]$.</p>
<p><strong>I.H.</strong>: Suppose $P(1) \land \ldots \land P(\lceil n/2 \rceil) \land \ldots \land P(n - 1)$</p>
<p><strong>I.S.</strong>:</p>
<p>Let $A = a_1, a_2, \ldots, a_n$, and $l, u$ be arbitrary numbers such that $l &lt; u$.  Let $m = \lceil n/2 \rceil$, and define $A_1 = a_1, \ldots, a_{m - 1}$, and $A_2 = a_m, \ldots, a_n$.</p>
<p>Since $|A_1| \le n - 1$, and $|A_2| \le n - 1$, we have that $P(|A_1|)$ and $P(|A_2|)$ holds. Thus, $L = S(A_1, l, u)$ and $R = S(A_2, l, u)$, which are the total number of interval sums in $A_1$ and $A_2$ respectively.</p>
<p>Considering the set $U \subset [n]^2$ of every possible interval over $A$, we can partition $U$ into two sets, ones that <strong>don't</strong> cross over the midpoint, $M^c$, and those that <strong>do</strong> cross over the midpoint, $M$. Note that $U = M \cup M^c$, and $M \cap M^c = \emptyset$.</p>
<p>By our inductive hypothesis, we have...</p>
<p>$$L + R = |{ (i, j) : (i, j) \in  M^c \land I(i, j) \in [l, u]}|$$</p>
<p>since we considered precisely the intervals in each side of $A$, which are exactly the intervals that don't cross the midpoint, and counted the number of such intervals that have $I(i, j) \in [l, u]$.</p>
<p>To find $|{ (i, j) : (i, j) \in  M \land I(i, j) \in [l, u]}| = C$, we must check each suitable pair $(i, j)$ that has $i &lt; m \le j$. We can first consider each $I(m, j)$ for $j \ge m$, and then find all such $I(i, m - 1)$ for $i \le m - 1$ such that $I(m, j) + I(i, m - 1) \in [l, u]$. Note that we don't need to consider all elements of $M$, since we can skip those that don't have $I(i, j) \in [l, u]$.</p>
<p>My algorithm does this by first calculating each $I(i, m - 1)$ and sorting them into a list $H$. Then, it iterates through all $I(m, j)$ for $m \le j \le n$, and searches for the lowest and highest index $i_{min}, i_{max}$ in $H$ such that $H_i + I(m, j) \in [l, u]$. We then calculate $C$ by maintaining a running sum of $i_{max} - i_{min} + 1$, ie the number of suitable $i$'s for a given $j$. This is guaranteed to consider each relevant $i &lt; m \le j$, since $H$ is sorted, and so all indices between and including $[i_{min}, i_{max}]$ would also be valid prefixes to the right half of the intervals we are considering, and those outside of $[i_{min}, i_{max}]$ would correspond to an interval sum that is outside $[l, u]$.</p>
<p>Therefore, we have...</p>
<p>$$C = |{ (i, j) : (i, j) \in  M \land I(i, j) \in [l, u]}|$$</p>
<p>And so $S(A, l, u) = L + R + C$ correctly considers all relevant interval sums, counting the number of interval sums between $[l, u]$.</p>
<pre><code class="language-python">def count_interval_sums_bruteforce(A, I, l, u, low, high):
  ans = 0
  for i in range(low, high):
    for j in range(i, high):
      s = I(i, j)
      if s &lt;= u and s &gt;= l:
        ans += 1
  return ans

def count_interval_sums_recursive(A, I, l, u, low, high):
  if high - low &lt;= 2:
    return count_interval_sums_bruteforce(A, I, l, u, low, high)

  mid = low + (high - low)//2
  left = count_interval_sums_recursive(A, I, l, u, low, mid)
  right = count_interval_sums_recursive(A, I, l, u, mid, high)

  total_sum = sum(A[low:high])
  left_sum = sum(A[low:mid])
  right_sum = total_sum - left_sum

  prefix = prefix_sum(A[low:high])
  suffix = suffix_sum(A[low:high])

  possible_left_halfs = sorted(
      [total - prefix[i] - right_sum for i, s in enumerate(suffix[:mid])]
  )

  cross = 0

  for i in range(len(prefix)//2, len(prefix)):
    right_half = right_sum - suffix[i]

    min_left_half = l - right_half
    max_left_half = u - right_half

    j = possible_left_halfs.binary_search(min_left_half)
    k = possible_left_halfs.binary_search(max_left_half)

    cross += k - j + 1

  return left + right + cross


def count_interval_sums(A, l, u):
  n = len(A)
  prefix, suffix = [0] * (n+1), [0] * (n+1)
  pre = 0
  total = sum(A)
  for i in range(n):
    prefix[i] = pre
    pre += A[i]
    suffix[i] = total - pre

  def I(i, j):
    return total - prefix[i] - suffix[j]

  return count_interval_sums_recursive(A, I, l, u, 0, len(A))
</code></pre>
        </div>
    </main>
</body>
</html>